!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PouchAllDbsPlugin=e()}(function(){return function r(o,i,u){function f(t,e){if(!i[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}n=i[t]={exports:{}},o[t][0].call(n.exports,function(e){return f(o[t][1][e]||e)},n,n.exports,r,o,i,u)}return i[t].exports}for(var c="function"==typeof require&&require,e=0;e<u.length;e++)f(u[e]);return f}({1:[function(e,i,t){!function(p,o){!function(){"use strict";var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==o?o:"undefined"!=typeof self?self:{};function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,t){return e(t={exports:{}},t.exports),t.exports}function a(o){return function(){var e=arguments,t=arguments.length;if(t){for(var n=[],r=-1;++r<t;)n[r]=e[r];return o.call(this,n)}return o.call(this,[])}}function n(){this.length=0}n.prototype.push=function(e){e={item:e};this.last?this.last=this.last.next=e:this.last=this.first=e,this.length++},n.prototype.shift=function(){var e=this.first;if(e)return this.first=e.next,--this.length||(this.last=void 0),e.item},n.prototype.slice=function(e,t){e=void 0===e?0:e,t=void 0===t?1/0:t;for(var n=[],r=0,o=this.first;o&&!(--t<0);o=o.next)++r>e&&n.push(o.item);return n};var d=n,v=t(function(e,t){function n(){}var r=l&&l.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),u=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)u.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return u},o=l&&l.__spread||function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t=t.concat(r(e[n]));return t},i=l&&l.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},u=(Object.defineProperty(t,"__esModule",{value:!0}),t.TaskQueue=void 0,i(a)),f=i(d),c=l.setImmediate||p.nextTick;function s(){this.queue=new f.default,this.running=!1}s.prototype.processNext=function(){var n,r=this;!r.running&&r&&r.queue&&r.queue.length&&(r.running=!0,n=r.queue.shift(),c(function(){n.fun(u.default(function(e){var t;(t=n.callback).apply.apply(t,o([null],e)),r.running=!1,r.processNext()}))}))},s.prototype.add=function(e,t){t=null!==t&&"function"==typeof t?t:n;this.queue.push({fun:e,callback:t}),this.processNext()},t.TaskQueue=s}),r=(e(v),v.TaskQueue,e(t(function(e,t){var h=l&&l.__awaiter||function(e,u,f,c){return new(f=f||Promise)(function(n,t){function r(e){try{i(c.next(e))}catch(e){t(e)}}function o(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof f?t:new f(function(e){e(t)})).then(r,o)}i((c=c.apply(e,u||[])).next())})},y=l&&l.__generator||function(r,o){var i,u,f,c={label:0,sent:function(){if(1&f[0])throw f[1];return f[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,u&&(f=2&t[0]?u.return:t[0]?u.throw||((f=u.return)&&f.call(u),0):u.next)&&!(f=f.call(u,t[1])).done)return f;switch(u=0,(t=f?[2&t[0],f.value]:t)[0]){case 0:case 1:f=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,u=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(f=0<(f=c.trys).length&&f[f.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!f||t[1]>f[0]&&t[1]<f[3]))c.label=t[1];else if(6===t[0]&&c.label<f[1])c.label=f[1],f=t;else{if(!(f&&c.label<f[2])){f[2]&&c.ops.pop(),c.trys.pop();continue}c.label=f[2],c.ops.push(t)}}t=o.call(r,c)}catch(e){t=[6,e],u=0}finally{i=f=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}};Object.defineProperty(t,"__esModule",{value:!0});t.default={pluginType:"function",pluginName:"allDbs",pluginFunction:function(e){var t=this,i="db_";var u,f,n=e,r=n&&Array.isArray(n.preferredAdapters)&&-1<n.preferredAdapters.indexOf("indexeddb")?"indexeddb":-1<n.preferredAdapters.indexOf("idb")?"idb":0<n.preferredAdapters.length?n.preferredAdapters[0]:null,o={},c=(r&&(o.adapter=r),"pouch__all_dbs__"),s=new v.TaskQueue;function l(e){e&&console.error(e)}function a(){s.add(function(e){if(u)return e();u=new n(c,o),e()})}function d(e){return e.replace(/^_pouch_/,"")}function p(e){return e===c||-1!==e.indexOf("-mrview-")||/^https?:\/\//.test(e)}n.on("created",function(t){p(t=d(t))||(t=i+t,a(),s.add(function(e){u.get(t).then(function(){}).catch(function(e){if("not_found"!==e.name)throw e;return u.put({_id:t})}).then(function(){f&&(f[t]=!0),e()})},l))}),n.on("destroyed",function(t){p(t=d(t))||(t=i+t,a(),s.add(function(e){u.get(t).then(function(e){return u.remove(e)}).catch(function(e){if("not_found"!==e.name)throw e}).then(function(){f&&delete f[t],e()},e)},l))});e.allDbs=function(){return h(t,void 0,void 0,function(){var t,r,n,o;return y(this,function(e){switch(e.label){case 0:e.trys.push([0,5,,6]),a(),t={startkey:i,endkey:i+"ï¿¿"},f={},r=[],e.label=1;case 1:return e.trys.push([1,3,,4]),[4,u.allDocs(t)];case 2:return n=e.sent(),(n&&n.rows&&Array.isArray(n.rows)?n.rows:[]).forEach(function(e){var t,n;r.push((t=e.key,n="string"==typeof(n=t)&&t.startsWith(i)?t.slice(i.length):n)),f[e.key]=!0}),[2,r];case 3:throw n=e.sent(),console.error(n),n;case 4:return[3,6];case 5:throw o=e.sent(),console.error(o),o;case 6:return[2]}})})},e.resetAllDbs=function(){return h(t,void 0,void 0,function(){var t;return y(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,u.destroy()];case 1:return e.sent(),f=u=null,[3,3];case 2:throw t=e.sent(),console.error(t),t;case 3:return[2]}})})}}}})));i.exports=r}.call(this)}.call(this,e(2),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],2:[function(e,t,n){"use strict";var r,o,t=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{o="function"==typeof clearTimeout?clearTimeout:u}catch(e){o=u}function f(t){if(r===setTimeout)return setTimeout(t,0);if((r===i||!r)&&setTimeout)return(r=setTimeout)(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}var c,s=[],l=!1,a=-1;function d(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&p())}function p(){if(!l){for(var e=f(d),t=(l=!0,s.length);t;){for(c=s,s=[];++a<t;)c&&c[a].run();a=-1,t=s.length}c=null,l=!1,!function(t){if(o===clearTimeout)return clearTimeout(t);if((o===u||!o)&&clearTimeout)return(o=clearTimeout)(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function y(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.push(new h(e,t)),1!==s.length||l||f(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=y,t.addListener=y,t.once=y,t.off=y,t.removeListener=y,t.removeAllListeners=y,t.emit=y,t.prependListener=y,t.prependOnceListener=y,t.listeners=function(e){return[]},t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}]},{},[1])(1)});
